{% extends "base.html" %}

{% block title %}{{ campaign.name }} - Charakter{% endblock %}

{% block content %}
<div class="container" style="max-width: 100%; padding: 15px 0;">
    <div style="padding: 0 15px;">
        <!-- Back Button -->
        <a href="{{ url_for('home') }}" style="display: inline-block; margin-bottom: 15px; color: var(--primary-color); text-decoration: none;">
            <i class="fas fa-arrow-left"></i> Zurück zur Übersicht
        </a>

        <!-- Character Form -->
        <div class="card" style="border-radius: 10px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div class="card-header" style="background-color: var(--primary-color); color: white; padding: 12px 15px;">
                <h2 style="margin: 0; font-size: 1.2em;">
                    <i class="fas fa-user-edit"></i> Mein Charakter in "{{ campaign.name }}"
                </h2>
            </div>
            <div class="card-body" style="padding: 20px;">
                <form method="POST" action="{{ url_for('manage_character', campaign_id=campaign.id) }}" enctype="multipart/form-data">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <!-- Left Column -->
                        <div>
                            <!-- Character Name -->
                            <div style="margin-bottom: 15px;">
                                <label for="character_name" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                    Charaktername <span style="color: red;">*</span>
                                </label>
                                <input type="text" id="character_name" name="character_name" 
                                       class="form-control" 
                                       value="{{ character.character_name if character else '' }}" 
                                       required
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small class="form-text text-muted">Wie soll dein Charakter im Chat und in der Spielerliste erscheinen?</small>
                            </div>

                            <!-- Class & Level -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                <div>
                                    <label for="character_class" style="display: block; margin-bottom: 5px; font-weight: 500;">Klasse</label>
                                    <input type="text" id="character_class" name="character_class" 
                                           class="form-control" 
                                           value="{{ character.character_class if character else '' }}"
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label for="level" style="display: block; margin-bottom: 5px; font-weight: 500;">Stufe</label>
                                    <input type="number" id="level" name="level" min="1" max="30"
                                           class="form-control" 
                                           value="{{ character.level if character else '' }}"
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>

                            <!-- Race -->
                            <div style="margin-bottom: 15px;">
                                <label for="race" style="display: block; margin-bottom: 5px; font-weight: 500;">Volk/Rasse</label>
                                <input type="text" id="race" name="race" 
                                       class="form-control" 
                                       value="{{ character.race if character else '' }}"
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div>
                            <!-- Character Image -->
                            <div style="margin-bottom: 20px; text-align: center;">
                                <div style="width: 150px; height: 150px; margin: 0 auto 15px; border-radius: 8px; overflow: hidden; background-color: #f5f5f5; display: flex; align-items: center; justify-content: center;">
                                    {% if character and character.image %}
                                        <img src="{{ character.get_image_url() }}" alt="{{ character.character_name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                    {% else %}
                                        <i class="fas fa-user" style="font-size: 4em; color: #999;"></i>
                                    {% endif %}
                                </div>
                                <label for="character_image" class="btn btn-secondary" style="display: inline-block; padding: 8px 15px; cursor: pointer; margin-bottom: 0;">
                                    <i class="fas fa-upload"></i> Bild hochladen
                                    <input type="file" id="character_image" name="character_image" accept="image/*" style="display: none;" onchange="previewImage(this)">
                                </label>
                                <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                                    Max. 5MB (JPG, PNG, GIF)
                                </div>
                            </div>

                            <!-- Description -->
                            <div>
                                <label for="description" style="display: block; margin-bottom: 5px; font-weight: 500;">Beschreibung</label>
                                <textarea id="description" name="description" rows="5" 
                                          class="form-control" 
                                          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;">{{ character.description if character else '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: right;">
                        <button type="submit" class="btn btn-primary" style="padding: 8px 20px; font-size: 1em;">
                            <i class="fas fa-save"></i> Speichern
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% include 'campaign_bottom_nav.html' %}

<script>
// Image preview functionality
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = input.closest('div').querySelector('img');
            if (preview) {
                preview.src = e.target.result;
            } else {
                const icon = input.closest('div').querySelector('i');
                if (icon) {
                    icon.style.display = 'none';
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    input.closest('div').insertBefore(img, icon);
                }
            }
        }
        reader.readAsDataURL(input.files[0]);
    }
}

// Form validation
const form = document.querySelector('form');
if (form) {
    form.addEventListener('submit', function(e) {
        const displayName = document.getElementById('display_name').value.trim();
        const charName = document.getElementById('character_name').value.trim();
        
        if (!displayName || !charName) {
            e.preventDefault();
            alert('Bitte fülle alle erforderlichen Felder aus.');
        }
    });
}
</script>

<style>
/* Responsive Design */
@media (max-width: 768px) {
    .card-body {
        padding: 15px !important;
    }
    
    .container {
        padding-bottom: 80px !important;
    }
    
    .card {
        margin-bottom: 15px !important;
    }
    
    .form-control {
        font-size: 16px !important; /* Prevents zoom on mobile */
    }
}

/* Form styling */
label {
    color: #555;
    font-size: 0.9em;
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}

.btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
}

.btn-secondary:hover {
    background-color: #5a6268;
    border-color: #545b62;
}

/* Image upload button */
input[type="file"] {
    display: none;
}

/* Character card styling */
.character-card {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.character-card h3 {
    margin-top: 0;
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
    margin-bottom: 12px;
}

.character-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 10px;
}

.character-info div {
    font-size: 0.9em;
}

.character-info strong {
    color: #555;
    display: inline-block;
    min-width: 80px;
}
</style>
{% endblock %}
